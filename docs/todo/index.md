# Список задач

Перечень задач по ALT Mobile

## Открытые

### Адаптация приложений под мобильный интерфейс

Их много, легион. Ниже неполный список.

#### Браузеры

Chromium и Firefox не влезают в вертикальной ориентации, нужно отредактировать профили, возможно, убрать боковые полосы.

- [ ] `firefox` Решение существует, но конфликтует с `firefox-esr`. В процессе решения сотрудником `@cas`

#### Telegram

- [ ] Добавить в telegram-desktop нужное масштабирование из коробки.
- [ ] Попробовать `telegrand`
- [ ] Альтернативный GTK-клиент `paper-plane` (собран, но падает)

#### Офисные приложения

- [ ] Libreoffice совсем грустно выглядит

#### Центр приложений

- [ ] Не все меню влазят в экран

#### Видео

- [ ] MPV: добавить экранную панель для управления через сенсор
- [ ] Доработать Cheese под мобильный интерфейс

### Собрать пакеты

#### Карты и геолокация

- [ ] `pure-maps` (в работе `@ved`)

### Доработка/разработка пакетов

#### Megapixels

- [ ] Добавить постобработку изображений с помощью OpenCV
- [ ] Добавить возможность записи видео?
- [ ] Исправить цветокоррекцию (сейчас изображение зелёное)

#### Будильник

- [ ] `waked`
- [ ] `gnome-clocks`: нужно патчить для поддержки `waked` (патч есть)

### Образ

#### Аллокация

- [ ] Выровнять аллокацию образа по eMMC erase block size (EBS). Иначе I/O будет медленным.
- [ ] Для определения EBS можно попробовать использовать [`flashbench`](https://github.com/bradfa/flashbench), есть смысл собрать пакет в Сизиф. Детали по технике работы в [LWN](https://lwn.net/Articles/428584/).

#### device-tree

- [ ] Добавить в `grub-config` нормальную поддержку указания `devicetree`. Низкий приоритет, пока что хватает `extlinux`

### Базовая ОС

#### Файловая система

- [ ] Перейти на `f2fs`

#### Полнодисковое шифрование (LUKS)

Следует встроить в загрузчик как в `pmos`

- [ ] [unl0kr](https://packages.altlinux.org/ru/sisyphus/srpms/unl0kr/)
- [ ] Поддержка в `make-initrd`, см. таск [337618](https://git.altlinux.org/tasks/337618/)
- [ ] Нужно добавить автозагрузку нужных модулей для сенсорного экрана и т.п. в `make-initrd`

#### Оптимизация загрузки

Сделать загрузку быстрее: посмотреть, что можно дополнительно распараллелить или отключить. Возможно, отказаться от GRUB в пользу прямой загрузки ядра через EFI.

- [ ] UEFI нужно для корректного отображения DMI информации

Автоматизация изменения разделов образа

#### GNSS

- [ ] Добавить поддержку аугментированного GNSS (A-GPS), после перехода на `pinephone_modem_sdk`

#### Поддержка других пользовательских оболочек

- [ ] SWMO
- [ ] KDE Plasma Mobile: есть в Сизифе, но сломана [BZ44714](https://bugzilla.altlinux.org/44714)

#### Интеграция с доменом

- [ ] Реализовать возможность добавления телефона в домен с применением политик (`@sin`)

#### Доработать pam для мобильных паролей

- [ ] Сейчас проверка слишком строгая и не разрешает цифровые пароли

#### Тревожный пароль

- [ ] Реализовать модуль pam для скриптованного управления вторичными паролями (например, для удаления данных или загрузки иного профиля).

### Оборудование

#### Аудио

- [ ] Разобраться с шумами / аудиофильтрами телефонии
- [ ] Подумать о возврате на `pipewire`. Это нужно для корректной работы скриншотов, скринкастов и удалённого рабочего стола в Wayland. Однако, возникает проблема некорректной маршрутизации звука. Вероятно, нужно написать профиль для `pipewire` на базе `ucm2` для `pulse`

#### A64

- [ ] Поддержка оборудования на базе Allwinner A64 (PinePhone)

#### Tow-Boot

- [ ] Собрать из исходников и предоставить инструмент обновления на SPI из ОС

#### Модем

- [ ] Собрать `pinephone_modem_sdk` из исходников для EG-25G
- [ ] Предоставить инструмент обновления `pinephone_modem_sdk` из дистрибутива

#### Сканер отпечатков пальцев

- [ ] Поддержка сканера отпечатков пальцев, например в виде [сменной крышки](https://files.pine64.org/doc/PinePhone/Schematic_fingerprint%20driver%20board%20V3_2021-01-24.pdf). За основу предлагается взять [`fprintd`](https://fprint.freedesktop.org/).

#### Аппаратный рендеринг

Полноценно использовать возможности GLES2 (Mali), в первую очередь в браузерах

- [ ] В Chromium

#### Аппаратное декодирование видео

Есть поддержка в ядре и наработки по `gstreamer` + `libva`, но последние сильно устарели

- [ ] Заявлена поддержка в Chromium (`chrome://gpu`), нужно проверить

#### PineTab2: Wi-Fi/Bluetooth

- [ ] Пока что на планшете PineTab2 Wi-Fi и Bluetooth не работают. Существует весьма экспериментальная поддержка

### Проблемы

#### Медленный I/O

- [ ] Скорость I/O меньше ожидаемой. Может быть связано с таском [Аллокация](#аллокация) и c таском [Файловая система](#фаиловая-система)

#### Проблемы доступа к камерам

- [ ] Часть приложений (Snapshot) не видит камеру даже при предоставлении доступа, возможно, связано с [проблемой в `libcamera`](https://patchwork.libcamera.org/patch/18345/), см. также апстримный баг.
- [ ] PineTab2: камеры не работают, передняя не распознаётся

## Выполненные задачи

### Собраны пакеты

#### Базовая телефония

- [x] Звонки (GNOME Calls)
- [x] SMS (Chatty)
- [x] Адресная книга (GNOME Contacts)

#### Мессенджеры

Telegram

- [x] Обновить `telegram-desktop` в Сизифе (очень не хватает полноценной поддержки топиков)
- [x] Проблема нестабильность новых версий [BZ47959](https://bugzilla.altlinux.org/47959)

#### Браузеры

- [x] Chromium
- [x] Firefox

#### Почтовые клиенты

- [x] Geary

#### Мультимедиа

- [x] Megapixels (фотокамера)
- [x] MPV (универсальный мультимедиа проигрыватель)
- [x] Clapper (универсальный мультимедиа проигрыватель)

#### Музыка

Адаптированные проигрыватели музыки под мобильный интерфейс:

- [x] Amberol — простой проигрыватель
- [x] Lollypop — сложный инструмент с управления альбомами, поддержкой сервисов и т.п.

#### Прочее

- [x] Калькулятор
- [x] Создание скриншотов

#### Waydroid

- [x] Собрать и наладить работу Waydroid для возможности запуска некоторых Android-приложений. Это сделано (спасибо `lakostis@`). Waydroid настроен из коробки. В мастере первого запуска нужно скачать образ Android.

#### Tweaks

- [x] Пользовательский инструмент тонкой настройки на базе `pmos-tweaks`. Спасибо `@arbars`

#### Карты и геолокация

- [x] GNOME Maps

#### Электронные книги

- [x] Foliate

#### Диктофон

- [x] GNOME Sound Recorder (`@aris`)

### Образ

#### Генерация

- [x] Создан и развивается [профиль](https://git.altlinux.org/people/bircoph/packages/mkimage-profiles.git) `mkimage-profiles`, наработки переносятся в основной пакет, основная разработка уже [там](https://git.altlinux.org/people/antohami/packages/mkimage-profiles.git)

#### Базовая локализация образа

- [x] Поддержка русского из коробки

#### Обои

- [x] Установка обоев фоном меню приложений, экрана блокировки
- [x] Установка обоев фоном экрана запуска `phosh-mobile-settings`

#### `polkit`

- [x] `Разрешить` беспарольную работу network manager

#### Возможности ОС

- [x] Сборка специализированного ядра

#### Сборка специализированного ядра

- [x] Ядро собрано на базе ядра `megous`

#### Автоматическая инициализация модема

- [x] В оригинальном `devicetree` не подавалось питание на модем

#### Экранная клавиатура в консоли

- [x] Есть: `squeakboard` + `hkdm` (`@shrek`)

### Проблемы

#### `tcb`

- [x] Добавлена поддержка `tcb` в Phosh Lock Screen, что позволяет корректно разблокировать экран на системах с `tcb` вместо классического `shadow`

#### `polkit`

- [x] Добавлены политики для беспарольного использования телефонии

#### Качество звука

- [x] `ucm2`: настроена конфигурация
- [x] `pulse`: выполнен переход на `pulseaudio`, основные проблемы решены. Требуется дополнительное тестирование телефонии

#### Загрузка тяжёлых приложений

- [x] Тяжелые приложения долго грузятся и могут вовсе не загрузиться при запуске с основного экрана. При этом всегда загружаются из консоли (VT). Нужно разобраться что из прибивает, возможно, где-то `timeout` в `phosh`. Длительность загрузки связана с таском [Медленный I/O](#медленныи-i-o/), но это не объясняет прерывание процесса запуска
- [x] Апстримный баг [GNOME](https://gitlab.gnome.org/GNOME/xdg-desktop-portal-gnome/-/issues/86) и [Flatpak](https://github.com/flatpak/xdg-desktop-portal/issues/986), [решение в Arch](https://bbs.archlinux.org/viewtopic.php?id=285590), [апстримный патч](https://github.com/flatpak/xdg-desktop-portal/pull/985), который не помог
  - [x] Решено серией правок: [BZ46978](https://bugzilla.altlinux.org/46978), [BZ46895](https://bugzilla.altlinux.org/46014) [BZ46014](https://bugzilla.altlinux.org/46014) [BZ47681](https://bugzilla.altlinux.org/47681)

#### Энергосбережение

- [x] Управление питанием модема через `udev`
- [x] доработка phosh [BZ48062](https://bugzilla.altlinux.org/48062) — позволяет не просыпаться от сообщений о скором засыпании, что приводило к фактическому отсутствию сна и быстрому расходу батареи

#### Отключения экрана

Время от времени экран спонтанно выключался и для включения нужна была перезагрузка устройства.

- [x] Частота наблюдения проблемы на разных устройствах разная
- [x] Это не просто выключение подсветки, а полное отключение экрана (проверено мощным фонариком)
- [x] Часто возникает, если оставить на зарядке на долгое время
- [x] Возможно, проблема связана с автоподстройкой яркости экрана и/или включенным сном по таймауту, включая режим питания от сети

Проблема решена `@shrek` в ядре в ветке 6.6. Проблема была в кривом `devicetree`
