# Anbernic RG 353M/P/PS/V/VS, Arc D/S.

:::danger Внимание!
Все действия, описанные в данной статье, вы выполняете на свой страх и риск. Автор статьи и сообщество ALT Linux Team, а также ООО "Базальт СПО" не несут ответственность за "окирпиченные" и сгоревшие приставки, затёртые данные пользователя, а также сгоревшие инструменты и прочие последствия.
:::

## Технические характеристики

::: tabs
== RG353M/P/V, ARC D

|     Компонент      |                                Название                                 |     Статус     |
| :----------------: | :---------------------------------------------------------------------: | :------------: |
|     Процессор      |                Rockchip RK3566,"Cortex-A55 x4", 1,8 Ггц                 | :green_circle: |
|      Графика       |                      Mali-G52 2EE, 2 ядра, 650Мгц                       | :green_circle: |
|      Дисплей       |                       4 дюйма, 640 x 480 пикселей                       | :green_circle: |
| Оперативная память |                               2 GB LPDDR4                               | :green_circle: |
| Постоянная память  |                 eMMC 64 Gb, 2 слота microSD (до 512 GB)                 | :green_circle: |
|  Сенсорная панель  |               Goodix / Hynitron cst3xx, 10 точек касания                | :green_circle: |
|      Питание       |                Сборка на 3500/3200 mAh, порт USB Type-C                 | :green_circle: |
|        WiFi        | Адаптер беспроводной сети Realtek RTL8188FTV 802.11b/g/n 1T1R 2.4G SDIO | :green_circle: |
|        Звук        |        2 динамика, порт для наушников 3,5мм, встроенный микрофон        | :green_circle: |
|    Вывод видео     |                                Mini HDMI                                | :green_circle: |
|        USB         |                          Порт USB Type-C (OTG)                          | :green_circle: |

== RG353PS/VS, ARC S

|     Компонент      |                                Название                                 |     Статус     |
| :----------------: | :---------------------------------------------------------------------: | :------------: |
|     Процессор      |                Rockchip RK3566,"Cortex-A55 x4", 1,8 Ггц                 | :green_circle: |
|      Графика       |                      Mali-G52 2EE, 2 ядра, 650Мгц                       | :green_circle: |
|      Дисплей       |                       4 дюйма, 640 x 480 пикселей                       | :green_circle: |
| Оперативная память |                               1 GB LPDDR4                               | :green_circle: |
| Постоянная память  |                       2 слота microSD (до 512 GB)                       | :green_circle: |
|      Питание       |                Сборка на 3500/3200 mAh, порт USB Type-C                 | :green_circle: |
|        WiFi        | Адаптер беспроводной сети Realtek RTL8188FTV 802.11b/g/n 1T1R 2.4G SDIO | :green_circle: |
|        Звук        |        2 динамика, порт для наушников 3,5мм, встроенный микрофон        | :green_circle: |
|    Вывод видео     |                                Mini HDMI                                | :green_circle: |
|        USB         |                          Порт USB Type-C (OTG)                          | :green_circle: |

:::

:::details Условные обозначения

:green_circle: `Работает` - работает в полном объёме

:yellow_circle: `Частично` - работает частично

:red_circle: `Не работает` - не работает

:white_circle: `Отсутствует` - не предусмотрено спецификацией

:::

## Подготовка карты памяти

Устанавливаем утилиту `alt-rootfs-installer`

```shell
su -
apt-get install alt-rootfs-installer
```

Скачиваем образ с ядром rocknix:

```shell
wget https://beta.altlinux.org/mobile/sisyphus/latest/alt-mobile-phosh-rocknix-latest-aarch64.img.xz
```

Вставляем адаптер с картой памяти в порт USB

```shell
su -
alt-rootfs-installer --image-in=/путь/до/образа.img.xz --media=/dev/sdX --target=anbernic-rgxx3-rk3566
```

## Подготовка приставки (для моделей RG353M / P / V и Arc D)

### Удаление Android

К превеликому сожалению, на текущий момент, для успешной загрузки и запуска ОС семейства ALT Linux на данных устройствах придётся затереть стоковый Android вместе с загрузчиком, ибо ни с чем, кроме стоковой прошивки от самой Anbernic, а также костылями с разбивкой карты памяти и патчами для загрузчика, загрузчик нормально не дружит.

Если мы решаем сделать копию содержимого встроенной памяти приставки, то нам ещё понадобится карта памяти объёмом от 128 гигабайт, чтобы в будущем восстановить стоковый Android. Если же сохранения Android не планируется, то пункты с 4 по 9 можно проигнорировать.

Переводим устройство в режим Recovery, зажав при запуске клавишу увеличения громкости. Мы попадаем в меню восстановления системы.

0. Подключаем устройство к ПК через разъём, который подписан как OTG. Все дальнейшие действие производим из под `root`:

```shell
su -
```

1. Устанавливаем `android-tools`:

```shell
apt-get install android-tools
```

2. Вводим одну за другой команды, дожидаясь завершения выполнения каждой из них.

Ищем наше устройство. Должна появиться строка к кодовым номером и названием «Recovery»:

```shell
adb devices
```

Получаем привилегии суперпользователя на системе устройства:

```shell
adb root
```

Заходим в устройство:

```shell
adb shell
```

3. Ищем блочное устройство памяти, которое будем затирать.

```shell
ls /dev/block/ | grep mmcblk
```

Встроенная память определится как `/dev/block/mmcblkX`, с большим количеством разделов.

4. Вставляем карту памяти во второй слот, она определится как `/dev/block/mmcblkY`, с одним разделом.

5. Монтируем раздел нашей карты памяти:

```shell
mount /dev/block/mmcblkYp1 /mnt
```

6. Создаём образ с содержимым eMMC:

```shell
dd if=/dev/block/mmcblkX of=/mnt/android_rg552.img
```

:::info
Создание образа будет долгой (объём встроенной памяти - 64 гигабайта).
:::

7. После завершения процесса отмонтируем карту памяти.

```shell
umount /mnt
```

и вынимаем карту из приставки

8. Начинаем затирание встроенного ПЗУ

```shell
dd if=/dev/zero of=/dev/block/mmcblkX bs=4M
```

И ждём, пока утилита нам не скажет, что место закончилось.

Вот и всё. По идее, теперь ALT Mobile должен загрузиться с карты памяти без проблем.

### Восстановление Android

Для восстановления Android нужно:

0. Вставить карту с образом Android во второй слот приставки. Запустить терминал и перейти в режим рута:

```shell
su -
```

1. Посмотреть список блочных устройств:

```shell
lsblk
```

Накопитель объёмом 58,2G с названием, схожим с `mmcblkXboot1`, и есть наша встроенная память, а устройство вида `/dev/mmcblkApB` с одним разделом без точки монтирования - карта памяти с образом.

2. Примонтировать раздел карты памяти с образом:

```shell
mount /dev/mmcblkApB /mnt
```

3. Записать образ стокового Android обратно во встроенную память с помощью dd:

```shell
dd if=/mnt/android_anbernic.img of=/dev/mmcblkX oflag=direct,sync iflag=fullblock bs=1M status=progress
```

По завершении записи выключить приставку, вынуть обе карты памяти, и включить устройство. Android должен начать загрузку.
